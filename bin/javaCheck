#!/bin/sh
set -o posix

if [ -e "$HOME"/.Kibrary/bin/.kibraryrc ]; then
  . "$HOME"/.Kibrary/bin/.kibraryrc || return 1
else
  printf "No file for variables. Please reinstall Kibrary.\n"
  exit 71
fi


print_get_java(){
  printf "Get the latest Java \033[1;31m%s\033[m from Oracle (http://www.oracle.com/technetwork/java/javase/downloads/index.html).\n" "$latest_version"
  ask_install_java
  return
}

ask_install_java(){
  printf "Do you want to install the latest Java by Oracle in %s (yes/no)\n" "$KIBRARY_DIR"
  read -r ans
  if [ "$ans" = "yes" ]; then
    javaDownload
  fi
  return
}

latest_version=\
$( (curl -s http://java.com/en/download/installed8.jsp 2>/dev/null || wget -q -O - http://java.com/en/download/installed8.jsp) | awk -F= '/latest8/{gsub(/^[^[:digit:]]*|\x27.*$/, "", $2); print $2}')

version=$($JAVA -version 2>&1 | awk '/version/{gsub(/\x22/,"",$3);print $3}')
printf "Java version in PATH is %s.\n" "$version"

version_final_number=${version#1.8.0_}
latest_version_final_number=${latest_version#1.8.0_}

if echo "$version" | grep -q '1.8'; then
  echo "Yes, we can run ANISOtime."
  if [ "$version_final_number" -lt "$latest_version_final_number" ]; then
    printf "\033[4mHowever\e[m, its version \033[1;31m%s\033[m may not be the latest \033[1;31m%s\033[m.\n" "$version" "$latest_version"
    print_get_java
  fi
  exit 0
else
  echo "It cannot run ANISOtime."
  print_get_java
  exit 1
fi



