#!/bin/bash
set -o posix

function print_get_java(){
  printf "Get the latest Java \033[1;31m%s\033[m from Oracle (http://www.oracle.com/technetwork/java/javase/downloads/index.html).\n" $latest_version
  return
}

if [ -z "${JAVA}" ] ; then
JAVA=java 
fi

latest_version=\
$((curl -s http://java.com/en/download/installed8.jsp 2>/dev/null || wget -q -O - http://java.com/en/download/installed8.jsp) | awk -F= '/latest8/{gsub(/^[^[:digit:]]*|\x27.*$/, "", $2); print $2}')

version=$($JAVA -version 2>&1 | \
  awk '/java version/{gsub(/\x22/,"",$3);print $3}')
printf "Java version in PATH is %s.\n" $version

if [ $(echo $version | grep -e '1.8') ]; then
  echo "Yes, we can run ANISOtime."
  if [[ "$version" < "$latest_version" ]]; then
    printf "\033[4mHowever\e[m, its version \033[1;31m%s\033[m may not be the latest \033[1;31m%s\033[m.\n" $version $latest_version
    print_get_java
  fi
  exit 0
else
  echo "It cannot run ANISOtime."
  print_get_java
  exit 1
fi



